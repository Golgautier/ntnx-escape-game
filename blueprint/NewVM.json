{"status":{},"spec":{"name":"New blank VM","description":"","resources":{"service_definition_list":[{"name":"NewVM","description":"","variable_list":[{"type":"LOCAL","name":"NewIP","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""}],"action_list":[{"type":"system","name":"action_create","description":"System action for creating an application","runbook":{"name":"8f4b2af0_runbook","description":"","task_definition_list":[{"type":"DAG","name":"dccc1926_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[{"name":"Add DNS Entry","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Add DNS Entry","description":"","attrs":{"type":"","script":"#!\/bin\/bash \n\nSHORTNAME=`echo @@{VMHostname}@@ | awk -F'.' '{ print $1 }'`\nDOMAIN=`echo @@{VMHostname}@@ | cut -d'.' -f2-`\n\nZONEFILE=`sudo ls \/var\/named\/zone.$DOMAIN`\n\n\nif [ \"$ZONEFILE\" == \"\" ]\nthen\n   echo \"No config file found for zone $DOMAIN\"\n   exit 2\nfi\n\nsudo grep \"@@{address}@@ \" $ZONEFILE >\/dev\/null 2>&1\n\nif [ $? -eq 0 ]\nthen\n    echo \"IP @@{NewIP}@@ is already in $ZONEFILE\"\n    exit 3\nfi\n\nsudo grep $SHORTNAME $ZONEFILE >\/dev\/null 2>&1\n\nif [ $? -eq 0 ]\nthen\n    echo \"Hostname $SHORTNAME is already in $ZONEFILE\"\n    exit 3\nfi\n\nsudo sh -c \"echo '$SHORTNAME    A    @@{address}@@' >> $ZONEFILE\"\n\necho \"New entry added in $ZONEFILE\"\n\necho \"New zone file :\"\nsudo echo $ZONEFILE\n\nsudo systemctl reload named\necho \"named reloaded\"\n\n\n","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"exec_target_reference":{"name":"Infra DNS Server_mpi_Infrastructure","kind":"app_endpoint"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"dccc1926_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_delete","description":"System action for deleting an application. Deletes created VMs as well","runbook":{"name":"73fac65b_runbook","description":"","task_definition_list":[{"type":"DAG","name":"b43773b8_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[{"name":"Remove DNS Entry","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Remove DNS Entry","description":"","attrs":{"type":"","script":"#!\/bin\/bash\n\nSHORTNAME=`echo @@{VMHostname}@@ | awk -F'.' '{ print $1 }'`\nDOMAIN=`echo @@{VMHostname}@@ | cut -d'.' -f2-`\n\nZONEFILE=`sudo ls \/var\/named\/zone.$DOMAIN`\n\n\nif [ \"$ZONEFILE\" == \"\" ]\nthen\n   echo \"No config file found for zone $DOMAIN\"\n   exit 2\nfi\n\nsudo grep -v \"^$SHORTNAME    A\" $ZONEFILE > \/tmp\/dns.tmp\n\nsudo mv \/tmp\/dns.tmp $ZONEFILE\n\necho \"Entry removed from $ZONEFILE\"\n\nsudo systemctl reload named\necho \"named reloaded\"\n\n\n","script_type":"sh","command_line_args":"","exit_status":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"exec_target_reference":{"name":"Infra DNS Server","kind":"app_endpoint"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"b43773b8_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_start","description":"System action for starting an application","runbook":{"name":"03059db5_runbook","description":"","task_definition_list":[{"type":"DAG","name":"ac4b8dc6_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"ac4b8dc6_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_stop","description":"System action for stopping an application","runbook":{"name":"2b65eb1f_runbook","description":"","task_definition_list":[{"type":"DAG","name":"3c5e4213_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"3c5e4213_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_restart","description":"System action for restarting an application","runbook":{"name":"0f89377f_runbook","description":"","task_definition_list":[{"type":"DAG","name":"ff08ef85_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"ff08ef85_dag","kind":"app_task"},"variable_list":[]},"critical":false}],"depends_on_list":[],"port_list":[],"singleton":false,"tier":""}],"published_service_definition_list":[],"substrate_definition_list":[{"type":"AHV_VM","name":"VM","description":"","variable_list":[],"action_list":[{"type":"fragment","name":"pre_action_create","description":"","runbook":{"name":"f3680c1d_runbook","description":"","task_definition_list":[{"type":"DAG","name":"37c942e3_dag","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"Get Variables from ConfFile","kind":"app_task"},"to_task_reference":{"name":"Get New IP from IPAM","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"Get New IP from IPAM","kind":"app_task"},"to_task_reference":{"name":"Get IPAM global information","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"Get IPAM global information","kind":"app_task"},"to_task_reference":{"name":"Set Network variable","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"Get Variables from ConfFile","kind":"app_task"},{"name":"Get New IP from IPAM","kind":"app_task"},{"name":"Get IPAM global information","kind":"app_task"},{"name":"Set Network variable","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"SET_VARIABLE","name":"Get Variables from ConfFile","description":"","attrs":{"type":"","script":"#script\n\nimport requests\n\ncustomername=\"@@{calm_project_name}@@\".replace(\" \",\"_\")\n\n\n#Get conf file from confserver depending project name\nurl=\"http:\/\/@@{ConfServer}@@\/\"+customername+\".json\"\n\nout=requests.get(url)\n\n#If conf fail is missing, use default one\nif out.status_code == 404:\n   url=\"http:\/\/@@{ConfServer}@@\/Default.json\"\n   out=requests.get(url) \n\ndonnees=json.loads(out.text)\n\nprint(\"IPAM_Server=\"+donnees['IPAM_Server'])\nprint(\"IPAM_API_Key=\"+donnees['IPAM_API_Key'])\nprint(\"IPAM_SubnetID=\"+donnees['IPAM_SubnetID']['@@{ProfileName}@@'])\nprint(\"IPAM_App_ID=\"+donnees['IPAM_App_ID'])","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["IPAM_Server","IPAM_API_Key","IPAM_SubnetID","IPAM_App_ID"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"HTTP","name":"Get New IP from IPAM","description":"","attrs":{"type":"HTTP","method":"POST","connection_timeout":120,"headers":[{"type":"LOCAL","name":"phpipam-token","description":"","regex":{"value":"","should_validate":true},"options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"state":"NOT_VALIDATED","message_list":[],"editables":{},"value":"@@{IPAM_API_Key}@@"}],"url":"https:\/\/@@{IPAM_Server}@@\/api\/@@{IPAM_App_ID}@@\/addresses\/first_free\/@@{IPAM_SubnetID}@@\/","request_body":"{\n\t\"hostname\": \"@@{VMHostname}@@\",\n    \"description\": \"Calm add-on\"\n}","content_type":"application\/json","expected_response_params":[{"type":"","code":200,"status":"SUCCESS"}],"authentication":{"type":"none"},"response_paths":{"NewIP":"data"},"tls_verify":false,"proxy_type":"","retry_count":1,"retry_interval":1},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"SET_VARIABLE","name":"Get IPAM global information","description":"","attrs":{"type":"","script":"#script\n\nimport requests\n\nurl=\"https:\/\/@@{IPAM_Server}@@\/api\/@@{IPAM_App_ID}@@\/subnets\/@@{IPAM_SubnetID}@@\"\nheaders={\"token\":\"@@{IPAM_API_Key}@@\"}\n\nout=requests.get(url,headers=headers,verify=False)\n\ndonnees=out.json()['data']\n\nprint(\"NetMask=\"+donnees['calculation']['Subnet netmask'])\nprint(\"GW_Address=\"+donnees['gateway']['ip_addr'])\n","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["NetMask","GW_Address"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"SET_VARIABLE","name":"Set Network variable","description":"","attrs":{"type":"","script":"# Get the JWT\njwt = '@@{calm_jwt}@@'\npc_ip=\"pc.ntnxlab.org\"\nmyNetwork=\"\"\"@@{Network}@@\"\"\".strip()\n\n\n## Create the Karbon Kubernetes cluster\n# Set the headers, payload, and cookies\n#GLheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json', 'Authorization': 'Bearer {}'.format(jwt)}\npayload={}\n\n\n  # Set the address and make images call\nurl = \"https:\/\/\"+pc_ip+\":9440\/api\/nutanix\/v3\/subnets\/list\"\n\nresp = urlreq(url, verb='POST',  params=json.dumps(payload), headers=headers, verify=False)\n#GL resp = urlreq(url, verb='POST',  params=json.dumps(payload), headers=headers, verify=False, auth=\"BASIC\", user='admin', passwd='nx2Tech736!')\n\n# If the call went through successfully, find the image by name\nif resp.ok:\n  subnets_list = json.loads(resp.content)\n  for subnet in subnets_list['entities']:\n      if (subnet['spec']['name'] == myNetwork ):\n          print(\"SelectedNetwork={\\\"name\\\": \\\"\"+subnet['spec']['name']+\"\\\", \\\"uuid\\\": \\\"\"+subnet['metadata']['uuid']+\"\\\" }\")\n          ","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["SelectedNetwork"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"37c942e3_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"fragment","name":"post_action_delete","description":"","runbook":{"name":"558349f9_runbook","description":"","task_definition_list":[{"type":"DAG","name":"ed6215fd_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[{"name":"Reset IPAM IP","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"HTTP","name":"Reset IPAM IP","description":"","attrs":{"type":"HTTP","method":"DELETE","connection_timeout":120,"headers":[{"type":"LOCAL","name":"token","description":"","regex":{"value":"","should_validate":true},"options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"state":"NOT_VALIDATED","message_list":[],"editables":{},"value":"@@{IPAM_API_Key}@@"}],"url":"https:\/\/@@{IPAM_Server}@@\/api\/@@{IPAM_App_ID}@@\/addresses\/@@{NewIP}@@\/@@{IPAM_SubnetID}@@\/","request_body":"","content_type":"application\/json","expected_response_params":[{"type":"","code":200,"status":"SUCCESS"}],"authentication":{"type":"none"},"response_paths":{},"tls_verify":false,"proxy_type":"","retry_count":1,"retry_interval":1},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"ed6215fd_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"fragment","name":"post_action_create","description":"","runbook":{"name":"c24f65bd_runbook","description":"","task_definition_list":[{"type":"DAG","name":"a3d82764_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"a3d82764_dag","kind":"app_task"},"variable_list":[]},"critical":false}],"editables":{"create_spec":{"resources":{}}},"create_spec":{"type":"","name":"vm-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"cluster_reference":{"type":"","kind":"cluster","name":"DM3-POC082","uuid":"0005fed3-1b0b-6ad0-0000-00000002acdd"},"resources":{"type":"","nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"@@{SelectedNetwork.uuid}@@"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[{"type":"ASSIGNED","ip":"@@{NewIP}@@"}],"network_function_chain_reference":null,"vpc_reference":null}],"power_state":"ON","guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"memory_size_mib":4096,"gpu_list":[],"parent_reference":null,"hardware_clock_timezone":"","account_uuid":"f0d93053-29bb-464d-b776-5706a4f8e57c","guest_customization":{"type":"","cloud_init":{"type":"","meta_data":"","user_data":"#cloud-config \n\npreserve_hostname: false\nfqdn: @@{VMHostname}@@\nusers:\n  - name: @@{nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n  - name: @@{Ansible.username}@@\n    ssh-authorized-keys:\n      - @@{Ansible.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n  - name: @@{Customer_user.username}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\nchpasswd:\n  list: |\n    @@{Customer_user.username}@@:@@{Customer_user.secret}@@\n  expire: False\nssh_pwauth: true   \nwrite_files:\n  - path: \/etc\/resolv.conf\n    content: |\n      nameserver @@{DNS_Address}@@    \n  "},"sysprep":null},"boot_config":{"type":"","boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"mac_address":"","boot_type":""},"disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"Rocky 8_9","uuid":"7aec1c83-0333-4877-9f21-a7878daafc67"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":0}],"serial_port_list":[]},"categories":{}},"os_type":"Linux","readiness_probe":{"login_credential_local_reference":{"name":"nutanix","kind":"app_credential"},"connection_type":"SSH","connection_port":22,"delay_secs":"60","retries":"10","address":"@@{NewIP}@@","disable_readiness_probe":true,"connection_protocol":""}},{"type":"AZURE_VM","name":"WM","description":"","variable_list":[],"action_list":[{"type":"fragment","name":"pre_action_create","description":"","runbook":{"name":"f3680c1d_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"37c942e3_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[{"name":"Get Variables from ConfFile_cloned_1","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"WM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"SET_VARIABLE","name":"Get Variables from ConfFile_cloned_1","description":"","attrs":{"type":"","script":"#script\n\nimport requests\n\n\n#Get conf file from confserver depending project name\nurl=\"http:\/\/@@{ConfServer}@@\/@@{calm_project_name}@@.json\"\n\nout=requests.get(url)\n\n#If conf fail is missing, use default one\nif out.status_code == 404:\n   url=\"http:\/\/@@{ConfServer}@@\/Default.json\"\n   out=requests.get(url) \n\ndonnees=json.loads(out.text)\n\nprint \"IPAM_Server=\"+donnees['IPAM_Server']\nprint \"IPAM_API_Key=\"+donnees['IPAM_API_Key']\nprint \"IPAM_SubnetID=\"+donnees['IPAM_SubnetID']['@@{ProfileName}@@']\nprint \"IPAM_App_ID=\"+donnees['IPAM_App_ID']","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["IPAM_Server","IPAM_API_Key","IPAM_SubnetID","IPAM_App_ID"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"WM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"37c942e3_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"fragment","name":"post_action_delete","description":"","runbook":{"name":"558349f9_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"ed6215fd_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"WM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"ed6215fd_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false}],"create_spec":{"type":"PROVISION_AZURE_VM","name":"","resources":{"type":"","account_uuid":"fbabcd38-80b1-233f-4c50-b9653af5a1c9","vm_name":"vm-@@{calm_unique_hash}@@-@@{calm_array_index}@@","location":"francecentral","resource_group":"\/subscriptions\/cf0a5f5c-2d21-43fb-ac64-9b18b7f1bbb6\/resourceGroups\/GL_Calm_RS","rg_operation":"use_existing","rg_details":{"type":"","rg_location":"","rg_tag_list":[],"delete_rg_if_empty":false},"availability_option":"AvailabilitySets","availability_set_id":"\/subscriptions\/cf0a5f5c-2d21-43fb-ac64-9b18b7f1bbb6\/resourceGroups\/GL_Calm_RS\/providers\/Microsoft.Compute\/availabilitySets\/GL_Calm_AS","availability_zone":"","os_profile":{"type":"","linux_config":{"type":"","disable_password_auth":false,"public_keys":[],"custom_data":"#cloud-config \n\npreserve_hostname: false\nfqdn: @@{VMHostname}@@\nusers:\n  - name: @@{nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n  - name: @@{Ansible.username}@@\n    ssh-authorized-keys:\n      - @@{Ansible.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n  - name: @@{Customer_user.username}@@\n    ssh-authorized-keys:\n      - @@{Customer_user.secret}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']  \nwrite_files:\n  - path: \/etc\/resolv.conf\n    content: |\n      nameserver @@{DNS_Address}@@    "},"windows_config":{"type":"","provision_vm_agent":true,"auto_updates":false,"time_zone":"","additional_unattend_content":[],"winrm_listeners":[]},"secrets":[]},"hw_profile":{"type":"","vm_size":"Basic_A0","max_data_disk_count":1},"storage_profile":{"type":"","is_managed":true,"image_details":{"type":"","source_image_type":"Marketplace","source_image_id":"","publisher":"RedHat","offer":"RHEL","sku":"8.2","version":"8.2.2020050811"},"os_disk_details":{"type":"","name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_type":"Standard_LRS","storage_name":"","caching_type":"ReadWrite","create_option":"FromImage","size_in_gb":-1,"lun":-1},"data_disk_list":[]},"nw_profile":{"type":"","nic_list":[{"type":"","nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","nsg_name":"","vnet_name":"","subnet_name":"","nsg_id":"\/subscriptions\/cf0a5f5c-2d21-43fb-ac64-9b18b7f1bbb6\/resourceGroups\/GL_Calm_RS\/providers\/Microsoft.Network\/networkSecurityGroups\/GL_Calm_SG","vnet_id":"\/subscriptions\/cf0a5f5c-2d21-43fb-ac64-9b18b7f1bbb6\/resourceGroups\/GL_Calm_RS\/providers\/Microsoft.Network\/virtualNetworks\/GL_Calm_NW","subnet_id":"\/subscriptions\/cf0a5f5c-2d21-43fb-ac64-9b18b7f1bbb6\/resourceGroups\/GL_Calm_RS\/providers\/Microsoft.Network\/virtualNetworks\/GL_Calm_NW\/subnets\/default","asg_list":[],"enable_ip_forwarding":false,"public_ip_info":{"type":"","ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0"},"private_ip_info":{"type":"","ip_allocation_method":"Dynamic","ip_address":""}}],"primary_nic":-1},"tag_list":[]}},"os_type":"Linux","readiness_probe":{"login_credential_local_reference":{"name":"nutanix","kind":"app_credential"},"connection_type":"SSH","connection_port":22,"delay_secs":"60","retries":"5","address":"@@{platform.publicIPAddressList[0]}@@","disable_readiness_probe":false,"connection_protocol":""}},{"type":"AHV_VM","name":"VM_win","description":"","variable_list":[],"action_list":[{"type":"fragment","name":"pre_action_create","description":"","runbook":{"name":"f3680c1d_runbook_cloned_1","description":"","task_definition_list":[{"type":"DAG","name":"37c942e3_dag_cloned_1","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"Get Variables from ConfFile_cloned_1","kind":"app_task"},"to_task_reference":{"name":"Get New IP from IPAM_cloned_1","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"Get New IP from IPAM_cloned_1","kind":"app_task"},"to_task_reference":{"name":"Get IPAM global information_cloned_1","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"Get IPAM global information_cloned_1","kind":"app_task"},"to_task_reference":{"name":"Set Network variable_cloned_1","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"Get Variables from ConfFile_cloned_1","kind":"app_task"},{"name":"Get New IP from IPAM_cloned_1","kind":"app_task"},{"name":"Get IPAM global information_cloned_1","kind":"app_task"},{"name":"Set Network variable_cloned_1","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"SET_VARIABLE","name":"Get Variables from ConfFile_cloned_1","description":"","attrs":{"type":"","script":"#script\n\nimport requests\n\ncustomername=\"@@{calm_project_name}@@\".replace(\" \",\"_\")\n\n\n#Get conf file from confserver depending project name\nurl=\"http:\/\/@@{ConfServer}@@\/\"+customername+\".json\"\n\nout=requests.get(url)\n\n#If conf fail is missing, use default one\nif out.status_code == 404:\n   url=\"http:\/\/@@{ConfServer}@@\/Default.json\"\n   out=requests.get(url) \n\ndonnees=json.loads(out.text)\n\nprint \"IPAM_Server=\"+donnees['IPAM_Server']\nprint \"IPAM_API_Key=\"+donnees['IPAM_API_Key']\nprint \"IPAM_SubnetID=\"+donnees['IPAM_SubnetID']['@@{ProfileName}@@']\nprint \"IPAM_App_ID=\"+donnees['IPAM_App_ID']","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["IPAM_Server","IPAM_API_Key","IPAM_SubnetID","IPAM_App_ID"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"HTTP","name":"Get New IP from IPAM_cloned_1","description":"","attrs":{"type":"HTTP","method":"POST","connection_timeout":120,"headers":[{"type":"LOCAL","name":"phpipam-token","description":"","regex":{"value":"","should_validate":true},"options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"state":"NOT_VALIDATED","message_list":[],"editables":{},"value":"@@{IPAM_API_Key}@@"}],"url":"https:\/\/@@{IPAM_Server}@@\/api\/@@{IPAM_App_ID}@@\/addresses\/first_free\/@@{IPAM_SubnetID}@@\/","request_body":"{\n\t\"hostname\": \"@@{VMHostname}@@\",\n    \"description\": \"Calm add-on\"\n}","content_type":"application\/json","expected_response_params":[{"type":"","code":200,"status":"SUCCESS"}],"authentication":{"type":"none"},"response_paths":{"NewIP":"data"},"tls_verify":false,"proxy_type":"","retry_count":1,"retry_interval":1},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"SET_VARIABLE","name":"Get IPAM global information_cloned_1","description":"","attrs":{"type":"","script":"#script\n\nimport requests\n\nurl=\"https:\/\/@@{IPAM_Server}@@\/api\/@@{IPAM_App_ID}@@\/subnets\/@@{IPAM_SubnetID}@@\"\nheaders={\"token\":\"@@{IPAM_API_Key}@@\"}\n\nout=requests.get(url,headers=headers,verify=False)\n\ndonnees=out.json()['data']\n\nprint \"NetMask=\"+donnees['calculation']['Subnet netmask']\nprint \"GW_Address=\"+donnees['gateway']['ip_addr']\n","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["NetMask","GW_Address"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"SET_VARIABLE","name":"Set Network variable_cloned_1","description":"","attrs":{"type":"","script":"# Get the JWT\njwt = '@@{calm_jwt}@@'\npc_ip=\"localhost\"\nmyNetwork=\"\"\"@@{Network}@@\"\"\".strip()\n\n\n## Create the Karbon Kubernetes cluster\n# Set the headers, payload, and cookies\n#GL headers = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json', 'Authorization': 'Bearer {}'.format(jwt)}\npayload={}\n\n\n  # Set the address and make images call\nurl = \"https:\/\/\"+pc_ip+\":9440\/api\/nutanix\/v3\/subnets\/list\"\n\nresp = urlreq(url, verb='POST',  params=json.dumps(payload), headers=headers, verify=False)\n#GL resp = urlreq(url, verb='POST',  params=json.dumps(payload), headers=headers, verify=False, auth=\"BASIC\", user='admin', passwd='nx2Tech736!')\n\n# If the call went through successfully, find the image by name\nif resp.ok:\n  subnets_list = json.loads(resp.content)\n  for subnet in subnets_list['entities']:\n      if (subnet['spec']['name'] == myNetwork ):\n          print(\"SelectedNetwork={\\\"name\\\": \\\"\"+subnet['spec']['name']+\"\\\", \\\"uuid\\\": \\\"\"+subnet['metadata']['uuid']+\"\\\" }\")\n          ","script_type":"static_py3","exit_status":[],"eval_scope":"local","eval_variables":["SelectedNetwork"]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"37c942e3_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"fragment","name":"post_action_delete","description":"","runbook":{"name":"558349f9_runbook_cloned_1","description":"","task_definition_list":[{"type":"DAG","name":"ed6215fd_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[{"name":"Reset IPAM IP_cloned_1","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"HTTP","name":"Reset IPAM IP_cloned_1","description":"","attrs":{"type":"HTTP","method":"DELETE","connection_timeout":120,"headers":[{"type":"LOCAL","name":"token","description":"","regex":{"value":"","should_validate":true},"options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"state":"NOT_VALIDATED","message_list":[],"editables":{},"value":"@@{IPAM_API_Key}@@"}],"url":"https:\/\/@@{IPAM_Server}@@\/api\/@@{IPAM_App_ID}@@\/addresses\/@@{NewIP}@@\/@@{IPAM_SubnetID}@@\/","request_body":"","content_type":"application\/json","expected_response_params":[{"type":"","code":200,"status":"SUCCESS"}],"authentication":{"type":"none"},"response_paths":{},"tls_verify":false,"proxy_type":"","retry_count":1,"retry_interval":1},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"ed6215fd_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"fragment","name":"post_action_create","description":"","runbook":{"name":"c24f65bd_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"a3d82764_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"a3d82764_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false}],"create_spec":{"type":"","name":"vm-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"cluster_reference":{"type":"","kind":"cluster","name":"DM3-POC082","uuid":"0005fed3-1b0b-6ad0-0000-00000002acdd"},"resources":{"type":"","nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"@@{SelectedNetwork.uuid}@@"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[{"type":"ASSIGNED","ip":"@@{NewIP}@@"}],"network_function_chain_reference":null,"vpc_reference":null}],"power_state":"ON","guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"memory_size_mib":4096,"gpu_list":[],"parent_reference":null,"hardware_clock_timezone":"","account_uuid":"f0d93053-29bb-464d-b776-5706a4f8e57c","guest_customization":{"type":"","cloud_init":null,"sysprep":{"type":"","install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n    <settings pass=\"specialize\">\n        <component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <ShowWindowsLive>false<\/ShowWindowsLive>\n            <TimeZone>Central Standard Time<\/TimeZone>\n        <\/component>\n        <component name=\"Microsoft-Windows-Security-SPP-UX\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n        <SkipAutoActivation>true<\/SkipAutoActivation>\n        <\/component>\n        <component name=\"Microsoft-Windows-SQMApi\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n        <CEIPEnabled>0<\/CEIPEnabled>\n        <\/component>\n    <\/settings>\n    <settings pass=\"oobeSystem\">\n        <component name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <InputLocale>en-US<\/InputLocale>\n            <SystemLocale>en-US<\/SystemLocale>\n            <UILanguage>en-US<\/UILanguage>\n            <UserLocale>en-US<\/UserLocale>\n        <\/component>\n        <component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <UserAccounts>\n                <AdministratorPassword>\n                    <Value>@@{WinLocalAdmin.secret}@@<\/Value>\n                    <PlainText>true<\/PlainText>\n                <\/AdministratorPassword>\n            <\/UserAccounts>\t\t\t\n            <OOBE>\n                <HideEULAPage>true<\/HideEULAPage>\n\t\t     <NetworkLocation>Work<\/NetworkLocation>\n            <\/OOBE>\n        <\/component>\n    <\/settings>\n<\/unattend>","is_domain":true,"domain":"ntnxlab.local","domain_credential_reference":{"name":"Domain_Admin","uuid":"e11d59df-6fe0-466f-b6bd-ffd373fd2372","kind":"app_credential"},"dns_ip":"@@{DNS_Address}@@","dns_search_path":""}},"boot_config":{"type":"","boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"mac_address":"","boot_type":""},"disk_list":[{"type":"","data_source_reference":{"type":"","kind":"image","name":"packer-windows-2022-oobe","uuid":"2f8d7d9f-c910-4e69-a541-e21eed1332b8"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":0}],"serial_port_list":[]},"categories":{}},"os_type":"Windows","readiness_probe":{"login_credential_local_reference":{"name":"Domain_Admin","kind":"app_credential"},"connection_type":"POWERSHELL","connection_port":5985,"delay_secs":"60","retries":"10","address":"@@{NewIP}@@","disable_readiness_probe":true,"connection_protocol":"http"}}],"package_definition_list":[{"type":"DEB","name":"NoPackage","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[{"name":"NewVM","kind":"app_service"}],"version":"","options":{"type":"","install_runbook":{"name":"9e88ad4c_runbook","description":"","task_definition_list":[{"type":"DAG","name":"d0e455fd_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NoPackage","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"d0e455fd_dag","kind":"app_task"},"variable_list":[]},"uninstall_runbook":{"name":"a5d061ea_runbook","description":"","task_definition_list":[{"type":"DAG","name":"aae169a7_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NoPackage","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"aae169a7_dag","kind":"app_task"},"variable_list":[]},"upgrade_runbook":{}}},{"type":"SUBSTRATE_IMAGE","name":"Rocky 8_9","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[],"version":"","options":{"type":"","name":"Rocky 8.9","resources":{"type":"","image_type":"DISK_IMAGE","checksum":{"type":"","checksum_algorithm":"","checksum_value":""},"source_uri":"https:\/\/download.rockylinux.org\/pub\/rocky\/8\/images\/x86_64\/Rocky-8-GenericCloud-Base-8.9-20231119.0.x86_64.qcow2","version":{"type":"","product_version":"8.9","product_name":"Rocky_8.9"},"architecture":"X86_64"},"description":""}},{"type":"DEB","name":"NoPackage_cloned_0","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[{"name":"NewVM","kind":"app_service"}],"version":"","options":{"type":"","install_runbook":{"name":"9e88ad4c_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"d0e455fd_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NoPackage_cloned_0","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"d0e455fd_dag_cloned_1","kind":"app_task"},"variable_list":[]},"uninstall_runbook":{"name":"a5d061ea_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"aae169a7_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NoPackage_cloned_0","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"aae169a7_dag_cloned_1","kind":"app_task"},"variable_list":[]},"upgrade_runbook":{}}},{"type":"DEB","name":"NoPackage_cloned_1","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[{"name":"NewVM","kind":"app_service"}],"version":"","options":{"type":"","install_runbook":{"name":"9e88ad4c_runbook_cloned_1","description":"","task_definition_list":[{"type":"DAG","name":"d0e455fd_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NoPackage_cloned_1","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"d0e455fd_dag_cloned_1","kind":"app_task"},"variable_list":[]},"uninstall_runbook":{"name":"a5d061ea_runbook_cloned_1","description":"","task_definition_list":[{"type":"DAG","name":"aae169a7_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NoPackage_cloned_1","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"aae169a7_dag_cloned_1","kind":"app_task"},"variable_list":[]},"upgrade_runbook":{}}}],"app_profile_list":[{"name":"OnPrem_Linux","description":"","variable_list":[{"type":"LOCAL","name":"IPAM_App_ID","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_Subnet_ID","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_API_Key","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_Server","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"NetMask","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"DNS_Address","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"GW_Address","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_Section","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"ProfileName","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":"OnPrem"},{"type":"LOCAL","name":"ConfServer","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":"10.55.82.84"},{"type":"EXEC_LOCAL","name":"CostCenter","description":"","regex":{"value":"^.*$","should_validate":false},"options":{"type":"EXEC","attrs":{"type":"EXEC","script":"#script\n\nimport requests\n\n#Get conf file from confserver depending project name\nurl=\"http:\/\/@@{ConfServer}@@\/@@{calm_project_name}@@.json\"\n\nout=requests.get(url)\n\n#If conf fail is missing, use default one\nif out.status_code == 404:\n   url=\"http:\/\/@@{ConfServer}@@\/Default.json\"\n   out=requests.get(url) \n\ndonnees=json.loads(out.text)\n\nout=requests.get(url,verify=False)\n\ntmp=out.json()['Cost_Center']\n\nseparator=\",\"\n\nprint(separator.join(tmp))\n","script_type":"static_py3","command_line_args":"","exit_status":[]}},"is_hidden":false,"is_mandatory":true,"data_type":"BASE","val_type":"STRING","label":"Cost Center refactur\u00e9 :","attrs":{"type":""},"editables":{"value":true},"value":""},{"type":"EXEC_LOCAL","name":"Network","description":"","options":{"type":"EXEC","attrs":{"type":"EXEC","script":"# Get the JWT\njwt = '@@{calm_jwt}@@'\npc_ip=\"pc.ntnxlab.org\"\n\n## Create the Karbon Kubernetes cluster\n# Set the headers, payload, and cookies\n#GL headers = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json', 'Authorization': 'Bearer {}'.format(jwt)}\npayload={}\n\n\n  # Set the address and make images call\nurl = \"https:\/\/\"+pc_ip+\":9440\/api\/nutanix\/v3\/environments\/list\"\nresp = urlreq(url, verb='POST',  params=json.dumps(payload), headers=headers, verify=False)\n#GL resp = urlreq(url, verb='POST',  params=json.dumps(payload), headers=headers, verify=False, auth=\"BASIC\", user='admin', passwd='nx2Tech736!')\nsubnets = []\n\n  # If the call went through successfully, find the image by name\nif resp.ok:\n  environments_list = json.loads(resp.content)\n  for env in environments_list['entities']:\n    if ( env['metadata']['name'] == \"@@{calm_environment_name}@@\" ):\n        # We found an environment with same name, check project\n        if ( env['metadata']['project_reference']['name'] == \"@@{calm_project_name}@@\" ):\n            for infra in env['status']['resources']['infra_inclusion_list']:\n                try:\n                    for net in infra['subnet_references']:\n                        # We have a Network ID. Looking for the network name\n                        url = \"https:\/\/\"+pc_ip+\":9440\/api\/nutanix\/v3\/subnets\/\"+net['uuid']\n                        resp = urlreq(url, verb='GET', headers=headers, verify=False)\n                        \n                        if resp.ok:\n                            subnets.append(json.loads(resp.content)['spec']['name'])\n\n                except:\n                    print(\"\")\n\nelse:\n  print(\"Request failed\",resp.__dict__)\n  exit(2)\n  \nprint(\",\".join(subnets))","script_type":"static_py3","command_line_args":"","exit_status":[]}},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":""},{"type":"LOCAL","name":"VMHostname","description":"","regex":{"value":"[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+","should_validate":true},"options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":true,"data_type":"BASE","val_type":"STRING","label":"VM Hostname (FQDN)","attrs":{"type":""},"editables":{"value":true},"value":""}],"action_list":[{"type":"user","name":"Truncate all logs to 1MB","description":"","runbook":{"name":"05fdb45b_runbook","description":"","task_definition_list":[{"type":"DAG","name":"451507d6_dag","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"Truncate logs","kind":"app_task"},"to_task_reference":{"name":"Delete old log files","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"Truncate logs","kind":"app_task"},{"name":"Delete old log files","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Truncate logs","description":"","attrs":{"type":"","script":"#!\/bin\/bash\n\nsudo find \/ -name *.log -exec truncate -s 1000000 {} \\;","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"nutanix","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Delete old log files","description":"","attrs":{"type":"","script":"#!\/bin\/sh\n\necho \"Fichier \u00e0 supprimer :\"\nsudo find \/ -name *.log -mtime +1 -exec ls -ltra {} \\;\n\necho \"Suppression...\"\nsudo find \/ -name *.log -mtime +1 -exec rm {} \\;","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"nutanix","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"451507d6_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"user","name":"Create Snapshot","description":"","runbook":{"name":"OnPrem_Snapshot_ConfigSnap_45a2_Runbook","description":"","task_definition_list":[{"type":"DAG","name":"OnPrem_Snapshot_ConfigSnap_45a2_Dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[{"name":"Snapshot_ConfigSnap_Task","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_CONFIG","name":"Snapshot_ConfigSnap_Task","description":"","attrs":{"type":"","config_spec_reference":{"name":"Snapshot_ConfigSnap","kind":"app_config_spec"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"OnPrem_Snapshot_ConfigSnap_45a2_Dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"user","name":"Restore Snapshot","description":"","runbook":{"name":"OnPrem_Restore_ConfigSnap_c77f_Runbook","description":"","task_definition_list":[{"type":"DAG","name":"OnPrem_Restore_ConfigSnap_c77f_Dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[{"name":"Restore_ConfigSnap_Task","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_CONFIG","name":"Restore_ConfigSnap_Task","description":"","attrs":{"type":"","config_spec_reference":{"name":"Restore_ConfigSnap","kind":"app_config_spec"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"OnPrem_Restore_ConfigSnap_c77f_Dag","kind":"app_task"},"variable_list":[]},"critical":false}],"deployment_create_list":[{"type":"GREENFIELD","name":"21611ee8_deployment","description":"","variable_list":[],"action_list":[],"depends_on_list":[],"min_replicas":"1","max_replicas":"1","default_replicas":"1","package_local_reference_list":[{"name":"NoPackage","kind":"app_package"}],"substrate_local_reference":{"name":"VM","kind":"app_substrate"},"published_service_local_reference_list":[]}],"snapshot_config_list":[{"type":"AHV_SNAPSHOT","name":"Snapshot_ConfigSnap","description":"","attrs_list":[{"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"snapshot_name":"","snapshot_type":"CRASH_CONSISTENT","snapshot_location_type":"LOCAL","num_of_replicas":"ONE"}],"variable_list":[{"type":"LOCAL","name":"snapshot_name","description":"","is_hidden":false,"is_mandatory":true,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"snapshot-@@{calm_array_index}@@-@@{calm_time}@@"},{"type":"LOCAL","name":"snapshot_type","description":"","is_hidden":false,"is_mandatory":true,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"CRASH_CONSISTENT"}],"runbook":{"name":"SYS_GEN__Runbook_Snapshot_ConfigSnap_3fc07315_2e87_2a54_056b_154134c8b4d9","description":"","task_definition_list":[{"type":"DAG","name":"SYS_GEN__DAG_Config_action_snapshot_create_3fc07315_2e87_2a54_056b_154134c8b4d9","description":"","attrs":{"type":"DAG","edges":[]},"child_tasks_local_reference_list":[{"name":"SYS_GEN__Nutanix_Snapshot_Create_da875197_b6bf_4b51_ac4f_5b12a210f31d","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"VM_SNAPSHOT_CREATE_NUTANIX","name":"SYS_GEN__Nutanix_Snapshot_Create_da875197_b6bf_4b51_ac4f_5b12a210f31d","description":"","attrs":{"type":"GENERIC_OPERATION","operation_type":"action_snapshot_create"},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"SYS_GEN__DAG_Config_action_snapshot_create_3fc07315_2e87_2a54_056b_154134c8b4d9","kind":"app_task"},"variable_list":[]},"config_reference_list":[{"name":"Restore_ConfigSnap","kind":"app_config_spec"}],"is_system_generated":false}],"restore_config_list":[{"type":"AHV_RESTORE","name":"Restore_ConfigSnap","description":"","attrs_list":[{"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"recovery_point_group_uuid":"","delete_vm_post_restore":true,"snapshot_location_type":"LOCAL","num_of_replicas":"ONE"}],"variable_list":[{"type":"LOCAL","name":"snapshot_uuids","description":"","is_hidden":false,"is_mandatory":true,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":""}],"runbook":{"name":"SYS_GEN__Runbook_Restore_ConfigSnap_07ebbb51_7d38_a8fb_ac66_46b840768467","description":"","task_definition_list":[{"type":"DAG","name":"SYS_GEN__DAG_Config_action_restore_07ebbb51_7d38_a8fb_ac66_46b840768467","description":"","attrs":{"type":"DAG","edges":[]},"child_tasks_local_reference_list":[{"name":"SYS_GEN__Nutanix_Restore_da875197_b6bf_4b51_ac4f_5b12a210f31d","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"VM_RESTORE_NUTANIX","name":"SYS_GEN__Nutanix_Restore_da875197_b6bf_4b51_ac4f_5b12a210f31d","description":"","attrs":{"type":"GENERIC_OPERATION","operation_type":"action_restore"},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"SYS_GEN__DAG_Config_action_restore_07ebbb51_7d38_a8fb_ac66_46b840768467","kind":"app_task"},"variable_list":[]},"config_reference_list":[],"is_system_generated":false}],"environment_reference_list":[],"application_url":"","patch_list":[{"type":"PATCH","name":"Update Compute","description":"","runbook":{"name":"SYS_GEN__Runbook_Patch_Update Conf_b73f8c5e_4c29_a603_27a4_a2a5788ac7fe","description":"","task_definition_list":[{"type":"DAG","name":"SYS_GEN__DAG_Patch_Update Conf_b73f8c5e_4c29_a603_27a4_a2a5788ac7fe","description":"","attrs":{"type":"DAG","edges":[]},"child_tasks_local_reference_list":[{"name":"Update Conf_meta_task","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"PATCH_META","name":"Update Conf_meta_task","description":"","attrs":{"type":"","patch_attrs_reference":[]},"child_tasks_local_reference_list":[{"name":"Update Conf_update_spec_task","kind":"app_task"},{"name":"Update Conf_NouvelleVM","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_SPEC","name":"Update Conf_update_spec_task","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"FOR_LOOP","name":"Update Conf_NouvelleVM","description":"","attrs":{"type":"","loop_over_list":"","exit_condition_type":"","loop_variable":"","loop_counter":"","patch_attr_reference":"7f907c90-4f44-0c6d-77a8-11faed6d33ae"},"child_tasks_local_reference_list":[{"name":"SYS_GEN__stop","kind":"app_task"},{"name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d","kind":"app_task"},{"name":"SYS_GEN__start","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__stop","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"2b65eb1f_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_NUTANIX","name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__start","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"03059db5_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"SYS_GEN__DAG_Patch_Update Conf_b73f8c5e_4c29_a603_27a4_a2a5788ac7fe","kind":"app_task"},"variable_list":[]},"attrs_list":[{"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"data":{"type":"nutanix","num_vcpus_per_socket_ruleset":{"type":"","operation":"equal","editable":true,"value":"1","min_value":1,"max_value":2},"num_sockets_ruleset":{"type":"","operation":"equal","editable":true,"value":"2","min_value":1,"max_value":8},"memory_size_mib_ruleset":{"type":"","operation":"equal","editable":true,"value":"4096","min_value":2048,"max_value":32768},"disk_delete_allowed":false,"categories_delete_allowed":false,"nic_delete_allowed":false,"categories_add_allowed":false,"pre_defined_disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"Centos_7_2009","uuid":"5e85b5a0-9615-4240-8bc4-f861cccf5275"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":null,"operation":"modify"}],"pre_defined_categories":[],"pre_defined_nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"56dea1e9-263d-4092-8f8f-9bfac61224a3"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[{"type":"ASSIGNED","ip":"@@{NewIP}@@"}],"network_function_chain_reference":null,"vpc_reference":null,"operation":"modify","identifier":"0","editable":false}]},"deployment_strategy":{"type":""},"uuid":"7f907c90-4f44-0c6d-77a8-11faed6d33ae"}],"variable_list":[],"config_reference_list":[],"is_system_generated":false},{"type":"PATCH","name":"Update Disks","description":"","runbook":{"name":"SYS_GEN__Runbook_Patch_Update Disks_a9497d03_9d09_85fd_710a_7d733465acb8","description":"","task_definition_list":[{"type":"DAG","name":"SYS_GEN__DAG_Patch_Update Disks_a9497d03_9d09_85fd_710a_7d733465acb8","description":"","attrs":{"type":"DAG","edges":[]},"child_tasks_local_reference_list":[{"name":"Update Disks_meta_task","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"PATCH_META","name":"Update Disks_meta_task","description":"","attrs":{"type":"","patch_attrs_reference":[]},"child_tasks_local_reference_list":[{"name":"Update Disks_update_spec_task","kind":"app_task"},{"name":"Update Disks_NouvelleVM","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_SPEC","name":"Update Disks_update_spec_task","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"FOR_LOOP","name":"Update Disks_NouvelleVM","description":"","attrs":{"type":"","loop_over_list":"","exit_condition_type":"","loop_variable":"","loop_counter":"","patch_attr_reference":"dc538ea6-8498-554d-937b-551e6b63d1ad"},"child_tasks_local_reference_list":[{"name":"SYS_GEN__stop","kind":"app_task"},{"name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d","kind":"app_task"},{"name":"SYS_GEN__start","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__stop","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"2b65eb1f_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_NUTANIX","name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__start","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"03059db5_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"SYS_GEN__DAG_Patch_Update Disks_a9497d03_9d09_85fd_710a_7d733465acb8","kind":"app_task"},"variable_list":[]},"attrs_list":[{"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"data":{"type":"nutanix","num_vcpus_per_socket_ruleset":{"type":""},"num_sockets_ruleset":{"type":""},"memory_size_mib_ruleset":{"type":""},"disk_delete_allowed":true,"categories_delete_allowed":false,"nic_delete_allowed":false,"categories_add_allowed":false,"pre_defined_disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"Centos_7_2009","uuid":"5e85b5a0-9615-4240-8bc4-f861cccf5275"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":null,"operation":"modify"},{"type":"","data_source_reference":null,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":-1,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":{"type":"","operation":"equal","editable":true,"value":"51200","min_value":1024,"max_value":512000},"operation":"add"}],"pre_defined_categories":[],"pre_defined_nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"56dea1e9-263d-4092-8f8f-9bfac61224a3"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[{"type":"ASSIGNED","ip":"@@{NewIP}@@"}],"network_function_chain_reference":null,"vpc_reference":null,"operation":"modify","identifier":"0","editable":false}]},"deployment_strategy":{"type":""},"uuid":"dc538ea6-8498-554d-937b-551e6b63d1ad"}],"variable_list":[],"config_reference_list":[],"is_system_generated":false},{"type":"PATCH","name":"Activer R\u00e9plication","description":"","runbook":{"name":"SYS_GEN__Runbook_Patch_Update Protection_1541b66f_1819_b13c_d657_7b8aead8adfc","description":"","task_definition_list":[{"type":"DAG","name":"SYS_GEN__DAG_Patch_Update Protection_1541b66f_1819_b13c_d657_7b8aead8adfc","description":"","attrs":{"type":"DAG","edges":[]},"child_tasks_local_reference_list":[{"name":"Update Protection_meta_task","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"PATCH_META","name":"Update Protection_meta_task","description":"","attrs":{"type":"","patch_attrs_reference":[]},"child_tasks_local_reference_list":[{"name":"Update Protection_update_spec_task","kind":"app_task"},{"name":"Update Protection_NouvelleVM","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_SPEC","name":"Update Protection_update_spec_task","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"FOR_LOOP","name":"Update Protection_NouvelleVM","description":"","attrs":{"type":"","loop_over_list":"","exit_condition_type":"","loop_variable":"","loop_counter":"","patch_attr_reference":"9cc8b66d-d4fa-82a4-2554-6d224c6f17e5"},"child_tasks_local_reference_list":[{"name":"SYS_GEN__stop","kind":"app_task"},{"name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d","kind":"app_task"},{"name":"SYS_GEN__start","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__stop","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"2b65eb1f_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_NUTANIX","name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__start","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"03059db5_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"SYS_GEN__DAG_Patch_Update Protection_1541b66f_1819_b13c_d657_7b8aead8adfc","kind":"app_task"},"variable_list":[]},"attrs_list":[{"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"data":{"type":"nutanix","num_vcpus_per_socket_ruleset":{"type":""},"num_sockets_ruleset":{"type":""},"memory_size_mib_ruleset":{"type":""},"disk_delete_allowed":false,"categories_delete_allowed":false,"nic_delete_allowed":false,"categories_add_allowed":false,"pre_defined_disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"Centos_7_2009","uuid":"5e85b5a0-9615-4240-8bc4-f861cccf5275"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":null,"operation":"modify"}],"pre_defined_categories":[{"type":"","value":"Protection:Yes","operation":"add"}],"pre_defined_nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"56dea1e9-263d-4092-8f8f-9bfac61224a3"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[{"type":"ASSIGNED","ip":"@@{NewIP}@@"}],"network_function_chain_reference":null,"vpc_reference":null,"operation":"modify","identifier":"0","editable":false}]},"deployment_strategy":{"type":""},"uuid":"9cc8b66d-d4fa-82a4-2554-6d224c6f17e5"}],"variable_list":[],"config_reference_list":[],"is_system_generated":false},{"type":"PATCH","name":"Supprimer R\u00e9plication","description":"","runbook":{"name":"SYS_GEN__Runbook_Patch_Supprimer R\u00e9plication_4dd14440_dd85_d285_08f3_79e1250d51c5","description":"","task_definition_list":[{"type":"DAG","name":"SYS_GEN__DAG_Patch_Supprimer R\u00e9plication_4dd14440_dd85_d285_08f3_79e1250d51c5","description":"","attrs":{"type":"DAG","edges":[]},"child_tasks_local_reference_list":[{"name":"Supprimer R\u00e9plication_meta_task","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"PATCH_META","name":"Supprimer R\u00e9plication_meta_task","description":"","attrs":{"type":"","patch_attrs_reference":[]},"child_tasks_local_reference_list":[{"name":"Supprimer R\u00e9plication_update_spec_task","kind":"app_task"},{"name":"Supprimer R\u00e9plication_NouvelleVM","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_SPEC","name":"Supprimer R\u00e9plication_update_spec_task","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"OnPrem_Linux","kind":"app_profile"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"FOR_LOOP","name":"Supprimer R\u00e9plication_NouvelleVM","description":"","attrs":{"type":"","loop_over_list":"","exit_condition_type":"","loop_variable":"","loop_counter":"","patch_attr_reference":"27c5a57b-a94d-b0ab-c736-ef03bd82a168"},"child_tasks_local_reference_list":[{"name":"SYS_GEN__stop","kind":"app_task"},{"name":"SYS_GEN__Nutanix_Update_2ee0aacf_0c45_4654_8e57_93e1820f3dfb","kind":"app_task"},{"name":"SYS_GEN__start","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__stop","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"2b65eb1f_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_NUTANIX","name":"SYS_GEN__Nutanix_Update_2ee0aacf_0c45_4654_8e57_93e1820f3dfb","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__start","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"03059db5_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"SYS_GEN__DAG_Patch_Supprimer R\u00e9plication_4dd14440_dd85_d285_08f3_79e1250d51c5","kind":"app_task"},"variable_list":[]},"attrs_list":[{"target_any_local_reference":{"name":"21611ee8_deployment","kind":"app_blueprint_deployment"},"data":{"type":"nutanix","num_vcpus_per_socket_ruleset":{"type":""},"num_sockets_ruleset":{"type":""},"memory_size_mib_ruleset":{"type":""},"disk_delete_allowed":false,"categories_delete_allowed":false,"nic_delete_allowed":false,"categories_add_allowed":false,"pre_defined_disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"Centos_7_2009","uuid":"f3460020-0c34-47ca-92cf-22cc7e358a5e"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":null,"operation":"modify"}],"pre_defined_categories":[{"type":"","value":"Protection:No","operation":"add"}],"pre_defined_nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"56dea1e9-263d-4092-8f8f-9bfac61224a3"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[{"type":"ASSIGNED","ip":"@@{NewIP}@@"}],"network_function_chain_reference":null,"vpc_reference":null,"operation":"modify","identifier":"0","editable":false}]},"deployment_strategy":{"type":""},"uuid":"27c5a57b-a94d-b0ab-c736-ef03bd82a168"}],"variable_list":[],"config_reference_list":[],"is_system_generated":false}]},{"name":"Azure _ Linux","description":"","variable_list":[{"type":"LOCAL","name":"IPAM_App_ID","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_Subnet_ID","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_API_Key","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_Server","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"NetMask","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"DNS_Address","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"GW_Address","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_Section","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"ProfileName","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":"Azure"},{"type":"LOCAL","name":"ConfServer","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":"10.55.82.84"},{"type":"EXEC_LOCAL","name":"CostCenter","description":"","regex":{"value":"^.*$","should_validate":false},"options":{"type":"EXEC","attrs":{"type":"EXEC","script":"#script\n\nimport requests\n\n#Get conf file from confserver depending project name\nurl=\"http:\/\/@@{ConfServer}@@\/@@{calm_project_name}@@.json\"\n\nout=requests.get(url)\n\n#If conf fail is missing, use default one\nif out.status_code == 404:\n   url=\"http:\/\/@@{ConfServer}@@\/Default.json\"\n   out=requests.get(url) \n\ndonnees=json.loads(out.text)\n\nout=requests.get(url,verify=False)\n\ntmp=out.json()['Cost_Center']\n\nseparator=\",\"\n\nprint(separator.join(tmp))\n","script_type":"static_py3","command_line_args":"","exit_status":[]}},"is_hidden":false,"is_mandatory":true,"data_type":"BASE","val_type":"STRING","label":"Cost Center refactur\u00e9 :","attrs":{"type":""},"editables":{"value":true},"value":""},{"type":"LOCAL","name":"VMHostname","description":"","regex":{"value":"[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+","should_validate":true},"options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":true,"data_type":"BASE","val_type":"STRING","label":"VM Hostname (FQDN)","attrs":{"type":""},"editables":{"value":true},"value":""}],"action_list":[{"type":"user","name":"Truncate all logs to 1MB","description":"","runbook":{"name":"05fdb45b_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"451507d6_dag_cloned_1","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"Truncate logs_cloned_1","kind":"app_task"},"to_task_reference":{"name":"Delete old log files_cloned_1","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"Truncate logs_cloned_1","kind":"app_task"},{"name":"Delete old log files_cloned_1","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Truncate logs_cloned_1","description":"","attrs":{"type":"","script":"#!\/bin\/bash\n\nsudo find \/ -name *.log -exec truncate -s 1000000 {} \\;","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"nutanix","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Delete old log files_cloned_1","description":"","attrs":{"type":"","script":"#!\/bin\/sh\n\necho \"Fichier \u00e0 supprimer :\"\nsudo find \/ -name *.log -mtime +1 -exec ls -ltra {} \\;\n\necho \"Suppression...\"\nsudo find \/ -name *.log -mtime +1 -exec rm {} \\;","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"nutanix","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"451507d6_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false}],"deployment_create_list":[{"type":"GREENFIELD","name":"2eccd53a_deployment","description":"","variable_list":[],"action_list":[],"depends_on_list":[],"min_replicas":"1","max_replicas":"1","default_replicas":"1","package_local_reference_list":[{"name":"NoPackage_cloned_0","kind":"app_package"}],"substrate_local_reference":{"name":"WM","kind":"app_substrate"},"published_service_local_reference_list":[]}],"snapshot_config_list":[],"restore_config_list":[],"environment_reference_list":[],"application_url":"","patch_list":[]},{"name":"OnPrem _ Windows","description":"","variable_list":[{"type":"LOCAL","name":"IPAM_App_ID","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_Subnet_ID","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_API_Key","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_Server","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"NetMask","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"DNS_Address","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"GW_Address","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"IPAM_Section","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":""},{"type":"LOCAL","name":"ProfileName","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":"OnPrem"},{"type":"LOCAL","name":"ConfServer","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":true,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":false},"value":"10.55.82.84"},{"type":"EXEC_LOCAL","name":"CostCenter","description":"","regex":{"value":"^.*$","should_validate":false},"options":{"type":"EXEC","attrs":{"type":"EXEC","script":"#script\n\nimport requests\n\n#Get conf file from confserver depending project name\nurl=\"http:\/\/@@{ConfServer}@@\/@@{calm_project_name}@@.json\"\n\nout=requests.get(url)\n\n#If conf fail is missing, use default one\nif out.status_code == 404:\n   url=\"http:\/\/@@{ConfServer}@@\/Default.json\"\n   out=requests.get(url) \n\ndonnees=json.loads(out.text)\n\nout=requests.get(url,verify=False)\n\ntmp=out.json()['Cost_Center']\n\nseparator=\",\"\n\nprint(separator.join(tmp))\n","script_type":"static_py3","command_line_args":"","exit_status":[]}},"is_hidden":false,"is_mandatory":true,"data_type":"BASE","val_type":"STRING","label":"Cost Center refactur\u00e9 :","attrs":{"type":""},"editables":{"value":true},"value":""},{"type":"EXEC_LOCAL","name":"Network","description":"","options":{"type":"EXEC","attrs":{"type":"EXEC","script":"# Get the JWT\njwt = '@@{calm_jwt}@@'\npc_ip=\"localhost\"\n\n## Create the Karbon Kubernetes cluster\n# Set the headers, payload, and cookies\n#GL headers = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json', 'Authorization': 'Bearer {}'.format(jwt)}\npayload={}\n\n\n  # Set the address and make images call\nurl = \"https:\/\/\"+pc_ip+\":9440\/api\/nutanix\/v3\/environments\/list\"\nresp = urlreq(url, verb='POST',  params=json.dumps(payload), headers=headers, verify=False)\n#GL resp = urlreq(url, verb='POST',  params=json.dumps(payload), headers=headers, verify=False, auth=\"BASIC\", user='admin', passwd='nx2Tech736!')\nsubnets = []\n  # If the call went through successfully, find the image by name\nif resp.ok:\n  environments_list = json.loads(resp.content)\n  for env in environments_list['entities']:\n    if ( env['metadata']['name'] == \"@@{calm_environment_name}@@\" ):\n        # We found an environment with same name, check project\n        if ( env['metadata']['project_reference']['name'] == \"@@{calm_project_name}@@\" ):\n            for infra in env['status']['resources']['infra_inclusion_list']:\n                try:\n                    for net in infra['subnet_references']:\n                        # We have a Network ID. Looking for the network name\n                        url = \"https:\/\/\"+pc_ip+\":9440\/api\/nutanix\/v3\/subnets\/\"+net['uuid']\n                        resp = urlreq(url, verb='GET', headers=headers, verify=False)\n                        \n                        if resp.ok:\n                            subnets.append(json.loads(resp.content)['spec']['name'])\n\n                except:\n                    print(\"\")\n\nelse:\n  print(\"Request failed\",resp.__dict__)\n  exit(2)\n  \nprint(\",\".join(subnets))","script_type":"static_py3","command_line_args":"","exit_status":[]}},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":""},{"type":"LOCAL","name":"VMHostname","description":"","regex":{"value":"[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+","should_validate":true},"options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":true,"data_type":"BASE","val_type":"STRING","label":"VM Hostname (FQDN)","attrs":{"type":""},"editables":{"value":true},"value":""}],"action_list":[{"type":"user","name":"Truncate all logs to 1MB_cloned_1","description":"","runbook":{"name":"05fdb45b_runbook_cloned_1","description":"","task_definition_list":[{"type":"DAG","name":"451507d6_dag_cloned_1","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"Truncate logs_cloned_1","kind":"app_task"},"to_task_reference":{"name":"Delete old log files_cloned_1","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"Truncate logs_cloned_1","kind":"app_task"},{"name":"Delete old log files_cloned_1","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Truncate logs_cloned_1","description":"","attrs":{"type":"","script":"#!\/bin\/bash\n\nsudo find \/ -name *.log -exec truncate -s 1000000 {} \\;","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"nutanix","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Delete old log files_cloned_1","description":"","attrs":{"type":"","script":"#!\/bin\/sh\n\necho \"Fichier \u00e0 supprimer :\"\nsudo find \/ -name *.log -mtime +1 -exec ls -ltra {} \\;\n\necho \"Suppression...\"\nsudo find \/ -name *.log -mtime +1 -exec rm {} \\;","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"nutanix","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"451507d6_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false}],"deployment_create_list":[{"type":"GREENFIELD","name":"4ecbe1db_deployment","description":"","variable_list":[],"action_list":[],"depends_on_list":[],"min_replicas":"1","max_replicas":"1","default_replicas":"1","package_local_reference_list":[{"name":"NoPackage_cloned_1","kind":"app_package"}],"substrate_local_reference":{"name":"VM_win","kind":"app_substrate"},"published_service_local_reference_list":[]}],"snapshot_config_list":[],"restore_config_list":[],"environment_reference_list":[],"application_url":"","patch_list":[{"type":"PATCH","name":"Update Compute_cloned_0","description":"","runbook":{"name":"SYS_GEN__Runbook_Patch_Update Conf_b73f8c5e_4c29_a603_27a4_a2a5788ac7fe_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"SYS_GEN__DAG_Patch_Update Conf_b73f8c5e_4c29_a603_27a4_a2a5788ac7fe_cloned_1","description":"","attrs":{"type":"DAG","edges":[]},"child_tasks_local_reference_list":[{"name":"Update Conf_meta_task_cloned_1","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"PATCH_META","name":"Update Conf_meta_task_cloned_1","description":"","attrs":{"type":"","patch_attrs_reference":[]},"child_tasks_local_reference_list":[{"name":"Update Conf_update_spec_task_cloned_1","kind":"app_task"},{"name":"Update Conf_NouvelleVM_cloned_1","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_SPEC","name":"Update Conf_update_spec_task_cloned_1","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"FOR_LOOP","name":"Update Conf_NouvelleVM_cloned_1","description":"","attrs":{"type":"","loop_over_list":"","exit_condition_type":"","loop_variable":"","loop_counter":"","patch_attr_reference":"7f907c90-4f44-0c6d-77a8-11faed6d33ae"},"child_tasks_local_reference_list":[{"name":"SYS_GEN__stop_cloned_1","kind":"app_task"},{"name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d_cloned_1","kind":"app_task"},{"name":"SYS_GEN__start_cloned_1","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"4ecbe1db_deployment","kind":"app_blueprint_deployment"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__stop_cloned_1","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"2b65eb1f_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_NUTANIX","name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d_cloned_1","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__start_cloned_1","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"03059db5_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"SYS_GEN__DAG_Patch_Update Conf_b73f8c5e_4c29_a603_27a4_a2a5788ac7fe_cloned_1","kind":"app_task"},"variable_list":[]},"attrs_list":[{"target_any_local_reference":{"name":"4ecbe1db_deployment","kind":"app_blueprint_deployment"},"data":{"type":"nutanix","num_vcpus_per_socket_ruleset":{"type":"","operation":"equal","editable":true,"value":"1","min_value":1,"max_value":2},"num_sockets_ruleset":{"type":"","operation":"equal","editable":true,"value":"2","min_value":1,"max_value":8},"memory_size_mib_ruleset":{"type":"","operation":"equal","editable":true,"value":"4096","min_value":2048,"max_value":32768},"disk_delete_allowed":false,"categories_delete_allowed":false,"nic_delete_allowed":false,"categories_add_allowed":false,"pre_defined_disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"Centos_7_2009","uuid":"5e85b5a0-9615-4240-8bc4-f861cccf5275"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":null,"operation":"modify"}],"pre_defined_categories":[],"pre_defined_nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"56dea1e9-263d-4092-8f8f-9bfac61224a3"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[{"type":"ASSIGNED","ip":"@@{NewIP}@@"}],"network_function_chain_reference":null,"vpc_reference":null,"operation":"modify","identifier":"0","editable":false}]},"deployment_strategy":{"type":""},"uuid":"ebf3c1c3-77ea-a95b-7191-2c72364424dc"}],"variable_list":[],"config_reference_list":[],"is_system_generated":false},{"type":"PATCH","name":"Update Disks_cloned_0","description":"","runbook":{"name":"SYS_GEN__Runbook_Patch_Update Disks_a9497d03_9d09_85fd_710a_7d733465acb8_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"SYS_GEN__DAG_Patch_Update Disks_a9497d03_9d09_85fd_710a_7d733465acb8_cloned_1","description":"","attrs":{"type":"DAG","edges":[]},"child_tasks_local_reference_list":[{"name":"Update Disks_meta_task_cloned_1","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"PATCH_META","name":"Update Disks_meta_task_cloned_1","description":"","attrs":{"type":"","patch_attrs_reference":[]},"child_tasks_local_reference_list":[{"name":"Update Disks_update_spec_task_cloned_1","kind":"app_task"},{"name":"Update Disks_NouvelleVM_cloned_1","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_SPEC","name":"Update Disks_update_spec_task_cloned_1","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"FOR_LOOP","name":"Update Disks_NouvelleVM_cloned_1","description":"","attrs":{"type":"","loop_over_list":"","exit_condition_type":"","loop_variable":"","loop_counter":"","patch_attr_reference":"dc538ea6-8498-554d-937b-551e6b63d1ad"},"child_tasks_local_reference_list":[{"name":"SYS_GEN__stop_cloned_1","kind":"app_task"},{"name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d_cloned_1","kind":"app_task"},{"name":"SYS_GEN__start_cloned_1","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"4ecbe1db_deployment","kind":"app_blueprint_deployment"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__stop_cloned_1","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"2b65eb1f_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_NUTANIX","name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d_cloned_1","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__start_cloned_1","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"03059db5_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"SYS_GEN__DAG_Patch_Update Disks_a9497d03_9d09_85fd_710a_7d733465acb8_cloned_1","kind":"app_task"},"variable_list":[]},"attrs_list":[{"target_any_local_reference":{"name":"4ecbe1db_deployment","kind":"app_blueprint_deployment"},"data":{"type":"nutanix","num_vcpus_per_socket_ruleset":{"type":""},"num_sockets_ruleset":{"type":""},"memory_size_mib_ruleset":{"type":""},"disk_delete_allowed":true,"categories_delete_allowed":false,"nic_delete_allowed":false,"categories_add_allowed":false,"pre_defined_disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"Centos_7_2009","uuid":"5e85b5a0-9615-4240-8bc4-f861cccf5275"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":null,"operation":"modify"},{"type":"","data_source_reference":null,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":-1,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":{"type":"","operation":"equal","editable":true,"value":"51200","min_value":1024,"max_value":512000},"operation":"add"}],"pre_defined_categories":[],"pre_defined_nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"56dea1e9-263d-4092-8f8f-9bfac61224a3"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[{"type":"ASSIGNED","ip":"@@{NewIP}@@"}],"network_function_chain_reference":null,"vpc_reference":null,"operation":"modify","identifier":"0","editable":false}]},"deployment_strategy":{"type":""},"uuid":"3420934f-0496-189e-1f18-d2187b860061"}],"variable_list":[],"config_reference_list":[],"is_system_generated":false},{"type":"PATCH","name":"Activer R\u00e9plication_cloned_0","description":"","runbook":{"name":"SYS_GEN__Runbook_Patch_Update Protection_1541b66f_1819_b13c_d657_7b8aead8adfc_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"SYS_GEN__DAG_Patch_Update Protection_1541b66f_1819_b13c_d657_7b8aead8adfc_cloned_1","description":"","attrs":{"type":"DAG","edges":[]},"child_tasks_local_reference_list":[{"name":"Update Protection_meta_task_cloned_1","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"PATCH_META","name":"Update Protection_meta_task_cloned_1","description":"","attrs":{"type":"","patch_attrs_reference":[]},"child_tasks_local_reference_list":[{"name":"Update Protection_update_spec_task_cloned_1","kind":"app_task"},{"name":"Update Protection_NouvelleVM_cloned_1","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_SPEC","name":"Update Protection_update_spec_task_cloned_1","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"FOR_LOOP","name":"Update Protection_NouvelleVM_cloned_1","description":"","attrs":{"type":"","loop_over_list":"","exit_condition_type":"","loop_variable":"","loop_counter":"","patch_attr_reference":"9cc8b66d-d4fa-82a4-2554-6d224c6f17e5"},"child_tasks_local_reference_list":[{"name":"SYS_GEN__stop_cloned_1","kind":"app_task"},{"name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d_cloned_1","kind":"app_task"},{"name":"SYS_GEN__start_cloned_1","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"4ecbe1db_deployment","kind":"app_blueprint_deployment"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__stop_cloned_1","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"2b65eb1f_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_NUTANIX","name":"SYS_GEN__Nutanix_Update_da875197_b6bf_4b51_ac4f_5b12a210f31d_cloned_1","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__start_cloned_1","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"03059db5_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"SYS_GEN__DAG_Patch_Update Protection_1541b66f_1819_b13c_d657_7b8aead8adfc_cloned_1","kind":"app_task"},"variable_list":[]},"attrs_list":[{"target_any_local_reference":{"name":"4ecbe1db_deployment","kind":"app_blueprint_deployment"},"data":{"type":"nutanix","num_vcpus_per_socket_ruleset":{"type":""},"num_sockets_ruleset":{"type":""},"memory_size_mib_ruleset":{"type":""},"disk_delete_allowed":false,"categories_delete_allowed":false,"nic_delete_allowed":false,"categories_add_allowed":false,"pre_defined_disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"Centos_7_2009","uuid":"5e85b5a0-9615-4240-8bc4-f861cccf5275"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":null,"operation":"modify"}],"pre_defined_categories":[{"type":"","value":"Protection:Yes","operation":"add"}],"pre_defined_nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"56dea1e9-263d-4092-8f8f-9bfac61224a3"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[{"type":"ASSIGNED","ip":"@@{NewIP}@@"}],"network_function_chain_reference":null,"vpc_reference":null,"operation":"modify","identifier":"0","editable":false}]},"deployment_strategy":{"type":""},"uuid":"30ef2e8e-6b84-687a-5e75-2e896bfeb532"}],"variable_list":[],"config_reference_list":[],"is_system_generated":false},{"type":"PATCH","name":"Supprimer R\u00e9plication_cloned_0","description":"","runbook":{"name":"SYS_GEN__Runbook_Patch_Supprimer R\u00e9plication_4dd14440_dd85_d285_08f3_79e1250d51c5_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"SYS_GEN__DAG_Patch_Supprimer R\u00e9plication_4dd14440_dd85_d285_08f3_79e1250d51c5_cloned_1","description":"","attrs":{"type":"DAG","edges":[]},"child_tasks_local_reference_list":[{"name":"Supprimer R\u00e9plication_meta_task_cloned_1","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"PATCH_META","name":"Supprimer R\u00e9plication_meta_task_cloned_1","description":"","attrs":{"type":"","patch_attrs_reference":[]},"child_tasks_local_reference_list":[{"name":"Supprimer R\u00e9plication_update_spec_task_cloned_1","kind":"app_task"},{"name":"Supprimer R\u00e9plication_NouvelleVM_cloned_1","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_SPEC","name":"Supprimer R\u00e9plication_update_spec_task_cloned_1","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"FOR_LOOP","name":"Supprimer R\u00e9plication_NouvelleVM_cloned_1","description":"","attrs":{"type":"","loop_over_list":"","exit_condition_type":"","loop_variable":"","loop_counter":"","patch_attr_reference":"27c5a57b-a94d-b0ab-c736-ef03bd82a168"},"child_tasks_local_reference_list":[{"name":"SYS_GEN__stop_cloned_1","kind":"app_task"},{"name":"SYS_GEN__Nutanix_Update_2ee0aacf_0c45_4654_8e57_93e1820f3dfb_cloned_1","kind":"app_task"},{"name":"SYS_GEN__start_cloned_1","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"4ecbe1db_deployment","kind":"app_blueprint_deployment"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__stop_cloned_1","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"2b65eb1f_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"UPDATE_NUTANIX","name":"SYS_GEN__Nutanix_Update_2ee0aacf_0c45_4654_8e57_93e1820f3dfb_cloned_1","description":"","attrs":{"type":""},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"VM_win","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"CALL_RUNBOOK","name":"SYS_GEN__start_cloned_1","description":"","attrs":{"type":"CALL_RUNBOOK","runbook_reference":{"name":"03059db5_runbook","kind":"app_runbook"},"inarg_list":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"NewVM","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"SYS_GEN__DAG_Patch_Supprimer R\u00e9plication_4dd14440_dd85_d285_08f3_79e1250d51c5_cloned_1","kind":"app_task"},"variable_list":[]},"attrs_list":[{"target_any_local_reference":{"name":"4ecbe1db_deployment","kind":"app_blueprint_deployment"},"data":{"type":"nutanix","num_vcpus_per_socket_ruleset":{"type":""},"num_sockets_ruleset":{"type":""},"memory_size_mib_ruleset":{"type":""},"disk_delete_allowed":false,"categories_delete_allowed":false,"nic_delete_allowed":false,"categories_add_allowed":false,"pre_defined_disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"Centos_7_2009","uuid":"f3460020-0c34-47ca-92cf-22cc7e358a5e"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":null,"operation":"modify"}],"pre_defined_categories":[{"type":"","value":"Protection:No","operation":"add"}],"pre_defined_nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"56dea1e9-263d-4092-8f8f-9bfac61224a3"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[{"type":"ASSIGNED","ip":"@@{NewIP}@@"}],"network_function_chain_reference":null,"vpc_reference":null,"operation":"modify","identifier":"0","editable":false}]},"deployment_strategy":{"type":""},"uuid":"5f627de7-c746-d248-c87a-a79aac181415"}],"variable_list":[],"config_reference_list":[],"is_system_generated":false}]}],"credential_definition_list":[{"type":"KEY","name":"nutanix","description":"","editables":{"secret":true},"username":"nutanix","secret":{"attrs":{"secret_reference":{},"is_secret_modified":false}},"cred_class":"static"},{"type":"KEY","name":"Ansible","description":"","editables":{"secret":true},"username":"ansible","secret":{"attrs":{"secret_reference":{},"is_secret_modified":false}},"cred_class":"static"},{"type":"PASSWORD","name":"Customer_user","description":"","editables":{"secret":true},"username":"admin","secret":{"attrs":{"secret_reference":{},"is_secret_modified":false}},"cred_class":"static"},{"type":"PASSWORD","name":"Domain_Admin","description":"","username":"NTNXLAB\\administrator","secret":{"attrs":{"secret_reference":{},"is_secret_modified":false}},"cred_class":"static"},{"type":"PASSWORD","name":"WinLocalAdmin","description":"","username":"administrator","secret":{"attrs":{"secret_reference":{},"is_secret_modified":false}},"cred_class":"static"}],"default_credential_local_reference":{"name":"Customer_user","kind":"app_credential"},"type":"USER","client_attrs":{"89cbf4cd-d9fa-76e6-3671-349b35149712":{"x":178.5,"y":176.80000686645508},"None":{"y":239,"x":577.75},"b9fe75c0-73bb-c9f4-5d5f-d4ff16c4c237":{"y":210,"x":388.75},"a3fe2a83-24ff-2e2c-5b5e-9ec0ad16bcce":{"y":196.5,"x":148.5},"df3198b6-db42-b06f-76e2-00c9874be8a9":{"y":196.5,"x":148.5},"24107626-0f9d-d908-dbb5-93347154bde2":{"y":210,"x":388.75},"39906cb9-c1a9-cf7a-3194-f06bb716c63b":{"x":178.5,"y":176.80000686645508},"718c8b55-f75c-2b5b-52d4-417e53c110d4":{"x":178.5,"y":176.80000686645508},"e0e34cfd-14f3-2478-c510-44f0cfe407cc":{"y":210,"x":388.75},"4964dc7d-5699-c63d-98fb-b66df7c8cc93":{"y":196.5,"x":148.5},"21611ee8_deployment":{"y":210,"x":388.75},"2eccd53a_deployment":{"y":210,"x":388.75},"4ecbe1db_deployment":{"y":210,"x":388.75}}}},"api_version":"3.0","product_version":"3.8.1","metadata":{"last_update_time":"1729161319870672","creation_time":"1701705550267490","spec_version":51,"name":"New blank VM","kind":"blueprint"},"contains_secrets":false}